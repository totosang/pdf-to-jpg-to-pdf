<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Pro Editor - Secure</title>
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>:root{--p:#28a745;--a:#ffc107;--d:#dc3545;--b:#e9ecef}body{font-family:Sarabun,sans-serif;background:var(--b);margin:0;padding:20px;display:flex;flex-direction:column;align-items:center}.main-toolbar{position:sticky;top:10px;z-index:1000;background:#fff;padding:15px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,.1);display:flex;gap:15px;flex-wrap:wrap;justify-content:center;align-items:center;width:95%}.tool-group{display:flex;align-items:center;gap:8px;border-right:1px solid #ddd;padding-right:12px}.tool-icon{width:42px;height:42px;border-radius:8px;border:2px solid #ddd;display:flex;align-items:center;justify-content:center;cursor:pointer;background:#fff}.tool-icon.active{border-color:var(--p);background:#e8f5e9}#page-list{display:flex;flex-wrap:wrap;gap:30px;justify-content:center;width:100%;margin-top:20px}.page-card{background:#fff;border:2px solid var(--p);border-radius:8px;position:relative;padding-bottom:40px}.rotate-btn{position:absolute;bottom:5px;left:50%;transform:translateX(-50%);background:#f8f9fa;border:1px solid #ccc;border-radius:20px;padding:4px 12px;cursor:pointer;font-size:12px;z-index:105}button,select{cursor:pointer;padding:8px 12px;border-radius:8px;border:1px solid #ccc;font-weight:700}.btn-main{background:var(--p)!important;color:#fff;border:none}.save-options{display:flex;flex-direction:column;gap:5px}</style>
</head>
<body>
<div class="main-toolbar">
    <div class="tool-group"><button onclick="_sa(1)">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏î</button><button onclick="_sa(0)">‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button></div>
    <div class="tool-group"><div class="tool-icon active" id="t-b" onclick="_st('brush')">üñåÔ∏è</div><div class="tool-icon" id="t-h" onclick="_st('highlighter')">üñçÔ∏è</div><div class="tool-icon" id="t-l" onclick="_st('line')">üìè</div></div>
    <div class="tool-group"><input type="color" id="c-c" value="#ffff00" onchange="_ub()"><input type="number" id="c-w" value="1" min="1" style="width:45px" onchange="_ub()"><input type="range" id="c-o" min="0.1" max="1" step="0.1" value="1" onchange="_ub()"></div>
    <div class="tool-group"><button class="btn-warn" onclick="_cl()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á</button></div>
    <div class="tool-group" style="border:none"><div class="save-options"><div style="display:flex;gap:5px">
        <select id="p-s"><option value="A4">A4</option><option value="LEGAL">Legal</option><option value="LETTER">Letter</option><option value="ORIGINAL">Original</option></select>
        <select id="s-m"><option value="merged">‡∏£‡∏ß‡∏°‡πÑ‡∏ü‡∏•‡πå</option><option value="split">‡πÅ‡∏¢‡∏Å‡πÑ‡∏ü‡∏•‡πå</option></select>
        <button class="btn-main" onclick="_ex()">üíæ Download</button>
    </div></div></div>
</div>
<div id="d-z" style="width:80%;padding:20px;border:2px dashed #999;text-align:center;background:#fff;margin:20px;border-radius:10px">‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF/‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</div>
<input type="file" id="f-i" multiple accept="application/pdf,image/*" style="display:none">
<div id="page-list"></div>
<script>
(function(){pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';const _0x=document,_pl=_0x.getElementById('page-list'),_fi=_0x.getElementById('f-i'),_dz=_0x.getElementById('d-z');let _cv={},_ct='brush';const _sz={A4:{w:595.28,h:841.89},LEGAL:{w:612,h:1008},LETTER:{w:612,h:792}};window._st=(t)=>{_ct=t;_0x.querySelectorAll('.tool-icon').forEach(e=>e.classList.remove('active'));_0x.getElementById('t-'+t[0]).classList.add('active');if(t==='highlighter'){_0x.getElementById('c-w').value=10;_0x.getElementById('c-o').value=0.4}else{_0x.getElementById('c-w').value=1;_0x.getElementById('c-o').value=1}_ub()};window._ub=()=>{const c=_0x.getElementById('c-c').value,w=parseInt(_0x.getElementById('c-w').value),o=parseFloat(_0x.getElementById('c-o').value);Object.values(_cv).forEach(i=>{i.f.isDrawingMode=(_ct==='brush');if(i.f.freeDrawingBrush){i.f.freeDrawingBrush.color=c;i.f.freeDrawingBrush.width=w;i.f.freeDrawingBrush.opacity=o}})};_dz.onclick=()=>_fi.click();_fi.onchange=(e)=>_hf(e.target.files);_dz.ondragover=(e)=>e.preventDefault();_dz.ondrop=(e)=>{e.preventDefault();_hf(e.dataTransfer.files)};async function _hf(fs){for(const f of fs){if(f.type==='application/pdf'){const b=await f.arrayBuffer(),p=await pdfjsLib.getDocument({data:b}).promise;for(let i=1;i<=p.numPages;i++)await _cp(await p.getPage(i),i)}else await _ci(f)}}async function _cp(p,n){const id='p-'+Math.random().toString(36).substr(2,9),vH=p.getViewport({scale:3}),vV=p.getViewport({scale:1}),cd=_0x.createElement('div');cd.className='page-card';cd.id=id;cd.innerHTML=`<input type="checkbox" class="p-cb" checked style="position:absolute;top:8px;left:8px;z-index:100"><button class="rotate-btn" onclick="_rp('${id}')">üîÑ ‡∏´‡∏°‡∏∏‡∏ô</button>`;const cE=_0x.createElement('canvas');cd.appendChild(cE);_pl.appendChild(cd);const f=new fabric.Canvas(cE,{width:vV.width*0.4,height:vV.height*0.4,isDrawingMode:!0}),tC=_0x.createElement('canvas'),ctx=tC.getContext('2d');tC.width=vH.width;tC.height=vH.height;await p.render({canvasContext:ctx,viewport:vH}).promise;fabric.Image.fromURL(tC.toDataURL('image/jpeg',0.9),m=>{m.scale((vV.width*0.4)/vH.width);f.setBackgroundImage(m,f.renderAll.bind(f))});_cv[id]={f,ow:vV.width,oh:vV.height,cr:0,bw:vV.width*0.4};_se(_cv[id]);_ub()}function _se(i){const f=i.f;let d,l;f.on('mouse:down',o=>{if(_ct==='brush')return;d=!0;const p=f.getPointer(o.e);l=new fabric.Line([p.x,p.y,p.x,p.y],{strokeWidth:parseInt(_0x.getElementById('c-w').value),stroke:_0x.getElementById('c-c').value,opacity:parseFloat(_0x.getElementById('c-o').value),selectable:!1,evented:!1,strokeLineCap:'round',globalCompositeOperation:_ct==='highlighter'?'multiply':'source-over'});f.add(l)});f.on('mouse:move',o=>{if(!d)return;const p=f.getPointer(o.e);if(_ct==='highlighter')l.set({x2:p.x,y2:l.y1});else l.set({x2:p.x,y2:p.y});f.renderAll()});f.on('mouse:up',()=>d=!1)}window._ex=async()=>{const m=_0x.getElementById('s-m').value,pk=_0x.getElementById('p-s').value,sd=Array.from(_0x.querySelectorAll('.page-card')).filter(c=>c.querySelector('.p-cb').checked);if(!sd.length)return alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô");const z=new JSZip(),{PDFDocument:PD}=PDFLib,mp=await PD.create();for(let i=0;i<sd.length;i++){const it=_cv[sd[i].id],f=it.f,ip=it.cr%180===0;let tw,th;if(pk==='ORIGINAL'){tw=ip?it.ow:it.oh;th=ip?it.oh:it.ow}else{tw=_sz[pk].w;th=_sz[pk].h}const ml=it.ow/f.width*f.getZoom(),du=f.toDataURL({format:'jpeg',quality:1,multiplier:ml}),eg=await mp.embedJpg(du),pg=mp.addPage([tw,th]),sc=Math.min(tw/eg.width,th/eg.height);pg.drawImage(eg,{x:(tw-eg.width*sc)/2,y:(th-eg.height*sc)/2,width:eg.width*sc,height:eg.height*sc});if(m==='split'){const sp=await PD.create(),[cp]=await sp.copyPages(mp,[mp.getPageCount()-1]);sp.addPage(cp);z.file(`p_${i+1}.pdf`,await sp.save())}}if(m==='merged')_dl(await mp.save(),"doc.pdf","application/pdf");else _dl(await z.generateAsync({type:"blob"}),"export.zip","application/zip")};window._rp=(id)=>{const i=_cv[id],f=i.f;i.cr=(i.cr+90)%360;const ip=i.cr%180===0,r=i.oh/i.ow,nw=ip?i.bw:i.bw*r,nh=ip?i.bw*r:i.bw;f.setDimensions({width:nw,height:nh});f.backgroundImage.set({angle:i.cr,left:f.getCenter().left,top:f.getCenter().top,originX:'center',originY:'center'});f.renderAll()};window._cl=()=>{if(confirm("‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏°‡∏î?"))Object.values(_cv).forEach(i=>i.f.getObjects().forEach(o=>{if(o!==i.f.backgroundImage)i.f.remove(o)}))};window._sa=(s)=>_0x.querySelectorAll('.p-cb').forEach(c=>c.checked=s);function _dl(d,n,t){const b=new Blob([d],{type:t}),l=_0x.createElement('a');l.href=URL.createObjectURL(b);l.download=n;l.click()}async function _ci(fl){const id='p-'+Math.random().toString(36).substr(2,9),u=URL.createObjectURL(fl);fabric.Image.fromURL(u,m=>{const cd=_0x.createElement('div');cd.className='page-card';cd.id=id;cd.innerHTML=`<input type="checkbox" class="p-cb" checked style="position:absolute;top:8px;left:8px;z-index:100"><button class="rotate-btn" onclick="_rp('${id}')">üîÑ ‡∏´‡∏°‡∏∏‡∏ô</button>`;const cE=_0x.createElement('canvas');cd.appendChild(cE);_pl.appendChild(cd);const f=new fabric.Canvas(cE,{width:m.width*0.2,height:m.height*0.2,isDrawingMode:!0});m.scale(0.2);f.setBackgroundImage(m,f.renderAll.bind(f));_cv[id]={f,ow:m.width,oh:m.height,cr:0,bw:m.width*0.2};_se(_cv[id]);_ub()})}()
</script>
</body>
</html>
